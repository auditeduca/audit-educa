import React, { useState, useMemo } from 'react';
import { 
  FileCheck, 
  ShieldAlert, 
  Search, 
  Database, 
  Cpu, 
  CheckCircle2, 
  AlertTriangle, 
  ChevronRight, 
  Layout, 
  Edit3, 
  Info, 
  Lock,
  PieChart,
  ClipboardList,
  Home,
  Settings,
  ArrowRight,
  UserCheck,
  Zap
} from 'lucide-react';

const App = () => {
  const [currentStep, setCurrentStep] = useState('planning');

  const steps = [
    { id: 'planning', label: 'Planejamento', icon: <Layout className="w-4 h-4" /> },
    { id: 'walkthrough', label: 'Walkthrough & ELC', icon: <Search className="w-4 h-4" /> },
    { id: 'controls', label: 'Controles (ToD/ToE)', icon: <ShieldAlert className="w-4 h-4" /> },
    { id: 'it_tests', label: 'Testes de TI', icon: <Cpu className="w-4 h-4" /> },
    { id: 'substantive', label: 'Testes Substantivos', icon: <Database className="w-4 h-4" /> },
    { id: 'conclusion', label: 'Conclusão', icon: <CheckCircle2 className="w-4 h-4" /> },
  ];

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
      
      {/* HEADER MODULAR AUDITEDUCA */}
      <header className="bg-white border-b border-slate-200 h-20 flex items-center px-8 justify-between sticky top-0 z-50">
        <div className="flex items-center gap-3">
          <div className="bg-slate-900 text-amber-500 p-2 rounded-xl">
            <FileCheck className="w-6 h-6" />
          </div>
          <div className="flex flex-col">
            <span className="text-xl font-black tracking-tighter uppercase italic leading-none">Audit<span className="text-amber-500">Educa</span></span>
            <span className="text-[9px] font-bold text-slate-400 tracking-widest uppercase mt-1">Audit Documentation Tool</span>
          </div>
        </div>
        
        <div className="hidden lg:flex items-center gap-2 bg-slate-100 p-1.5 rounded-2xl">
          {steps.map((step) => (
            <button
              key={step.id}
              onClick={() => setCurrentStep(step.id)}
              className={`flex items-center gap-2 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all ${
                currentStep === step.id 
                ? 'bg-white text-amber-600 shadow-sm' 
                : 'text-slate-400 hover:text-slate-600'
              }`}
            >
              {step.icon}
              {step.label}
            </button>
          ))}
        </div>

        <div className="flex items-center gap-4">
          <div className="h-8 w-px bg-slate-200 mx-2"></div>
          <div className="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-[10px] font-black uppercase">High Risk</div>
          <button className="p-2 text-slate-400 hover:text-amber-500"><Settings className="w-5 h-5" /></button>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        {/* BREADCRUMB */}
        <nav className="flex items-center gap-2 text-[10px] font-black uppercase text-slate-400 mb-8 tracking-widest">
          <Home className="w-3 h-3" /> Home <ChevronRight className="w-3 h-3" /> Papéis de Trabalho <ChevronRight className="w-3 h-3" /> Journal Entries Audit
        </nav>

        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
          
          {/* CONTENT AREA */}
          <div className="lg:col-span-9 space-y-8">
            
            {/* STEP 1: PLANNING & WALKTHROUGH */}
            {(currentStep === 'planning' || currentStep === 'walkthrough') && (
              <section className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-8">
                <div className="bg-white rounded-[2.5rem] p-10 border border-slate-100 shadow-sm">
                  <h2 className="text-2xl font-black text-slate-900 mb-6 flex items-center gap-3">
                    <Layout className="w-6 h-6 text-amber-500" /> Planejamento e Entendimento do Processo
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div className="space-y-4">
                      <label className="text-[10px] font-black uppercase text-slate-400 tracking-widest">Escopo da Auditoria (JE)</label>
                      <textarea className="w-full h-32 bg-slate-50 border-none rounded-2xl p-4 text-sm focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Defina o período, entidades e threshold de materialidade para os testes de JE..." defaultValue={"O escopo abrange todos os lançamentos manuais e automáticos realizados no Ledger Principal durante o exercício de 2025, com foco em reversões e ajustes de final de período."}></textarea>
                    </div>
                    <div className="space-y-4">
                      <label className="text-[10px] font-black uppercase text-slate-400 tracking-widest">Walkthrough do Processo</label>
                      <textarea className="w-full h-32 bg-slate-50 border-none rounded-2xl p-4 text-sm focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Descreva o fluxo desde a origem até o lançamento no GL..."></textarea>
                    </div>
                  </div>
                </div>

                <div className="bg-slate-900 rounded-[2.5rem] p-10 text-white relative overflow-hidden group">
                  <ShieldAlert className="absolute -right-8 -bottom-8 w-48 h-48 text-white/5 transform -rotate-12 group-hover:rotate-0 transition-transform duration-700" />
                  <div className="relative z-10">
                    <h3 className="text-xl font-black mb-6 flex items-center gap-2 text-amber-500">
                      <Zap className="w-5 h-5" /> Risco Presumido de Fraude (ISA 240)
                    </h3>
                    <p className="text-sm text-slate-400 mb-6 leading-relaxed">
                      De acordo com a ISA 240, existe um risco presumido de fraude relacionado à burla dos controles pela administração (Management Override). Nosso approach foca em:
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <RiskFlag label="Lançamentos Manuais" status="Critical" />
                      <RiskFlag label="Ajustes de Consolidação" status="High" />
                      <RiskFlag label="Postagens de Usuários Privilegiados" status="Critical" />
                    </div>
                  </div>
                </div>
              </section>
            )}

            {/* STEP 2: CONTROLS (ToD / ToE) */}
            {currentStep === 'controls' && (
              <section className="animate-in fade-in slide-in-from-right-4 duration-500 space-y-8">
                <div className="bg-white rounded-[2.5rem] p-10 border border-slate-100 shadow-sm">
                  <h2 className="text-2xl font-black text-slate-900 mb-8">Matriz de Testes de Controles</h2>
                  <div className="overflow-x-auto">
                    <table className="w-full text-left">
                      <thead>
                        <tr className="border-b border-slate-50">
                          <th className="px-4 py-4 text-[10px] font-black uppercase text-slate-400 tracking-widest">ID Controle</th>
                          <th className="px-4 py-4 text-[10px] font-black uppercase text-slate-400 tracking-widest">Descrição do Controle</th>
                          <th className="px-4 py-4 text-[10px] font-black uppercase text-slate-400 tracking-widest">Design (ToD)</th>
                          <th className="px-4 py-4 text-[10px] font-black uppercase text-slate-400 tracking-widest">Efetividade (ToE)</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-50">
                        <ControlRow id="JE.01" desc="Segregação de funções entre quem prepara e quem aprova o lançamento manual." tod="Aprovado" toe="Efetivo" />
                        <ControlRow id="JE.02" desc="Sistema bloqueia lançamentos manuais em contas de controle automáticas." tod="Aprovado" toe="Efetivo" />
                        <ControlRow id="JE.03" desc="Revisão mensal de log de alterações em usuários com perfil de superuser." tod="Aprovado" toe="Deficiência" />
                      </tbody>
                    </table>
                  </div>
                </div>

                <div className="bg-amber-50 rounded-[2.5rem] p-10 border border-amber-100">
                  <h3 className="text-lg font-black text-amber-900 mb-4 flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5" /> Racionalização de Deficiências
                  </h3>
                  <p className="text-sm text-amber-800 leading-relaxed mb-6">
                    Para o controle <strong>JE.03</strong>, foi identificada uma falha na periodicidade da revisão durante o Q3.
                  </p>
                  <div className="bg-white p-6 rounded-2xl border border-amber-200">
                    <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block">Análise de Impacto & Oportunidade</label>
                    <textarea className="w-full h-24 border-none text-sm focus:ring-0 outline-none p-0 bg-transparent" placeholder="Descreva como essa deficiência afeta o approach substantivo..."></textarea>
                  </div>
                </div>
              </section>
            )}

            {/* STEP 3: IT TESTS */}
            {currentStep === 'it_tests' && (
              <section className="animate-in zoom-in-95 duration-500 space-y-8">
                <div className="bg-white rounded-[2.5rem] p-10 border border-slate-100 shadow-sm">
                  <h2 className="text-2xl font-black text-slate-900 mb-6 flex items-center gap-3">
                    <Cpu className="w-6 h-6 text-indigo-500" /> Testes de TI (ITGC & ITAC)
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <ITTestCard title="Integridade de Dados (IPE/IPI)" desc="Verificação se o relatório extraído do ERP para o teste substantivo contém a população completa (GL vs Trial Balance)." status="Validado" />
                    <ITTestCard title="Configuração de Workflow" desc="Teste de sistema para garantir que o 'Hard Block' de aprovação está ativo no ambiente de produção." status="Em Progresso" />
                  </div>
                </div>
              </section>
            )}

            {/* STEP 4: SUBSTANTIVE (JET) */}
            {currentStep === 'substantive' && (
              <section className="animate-in fade-in duration-500 space-y-8">
                <div className="bg-white rounded-[2.5rem] p-10 border border-slate-100 shadow-sm">
                  <div className="flex items-center justify-between mb-10">
                    <h2 className="text-2xl font-black text-slate-900 flex items-center gap-3">
                      <Database className="w-6 h-6 text-emerald-500" /> Journal Entry Testing (JET)
                    </h2>
                    <span className="bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full text-[10px] font-black uppercase">Data Analytics Approach</span>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                    <CriteriaCard icon={<UserCheck className="w-5 h-5" />} title="Who" desc="Usuários não autorizados ou superusers." />
                    <CriteriaCard icon={<PieChart className="w-5 h-5" />} title="What" desc="Contas sensíveis (Caixa, PCLD, Provisões)." />
                    <CriteriaCard icon={<Calendar className="w-5 h-5" />} title="When" desc="Finais de semana, feriados ou 31/12." />
                  </div>

                  <div className="space-y-4">
                    <h4 className="text-xs font-black uppercase text-slate-400 tracking-widest">Amostragem de High Risk</h4>
                    <div className="bg-slate-50 rounded-2xl p-6 border border-slate-100">
                      <div className="flex justify-between items-center mb-4">
                        <span className="text-sm font-bold text-slate-700">População Total: 145.200 lançamentos</span>
                        <span className="text-sm font-bold text-amber-600">Amostra High Risk: 120 lançamentos</span>
                      </div>
                      <div className="h-2 w-full bg-slate-200 rounded-full overflow-hidden">
                        <div className="h-full bg-amber-500 w-[15%]"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            )}

            {/* STEP 5: CONCLUSION */}
            {currentStep === 'conclusion' && (
              <section className="animate-in zoom-in-95 duration-500 space-y-8">
                <div className="bg-white rounded-[2.5rem] p-12 border border-slate-100 shadow-sm text-center">
                  <div className="bg-green-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <CheckCircle2 className="w-10 h-10 text-green-500" />
                  </div>
                  <h2 className="text-3xl font-black text-slate-900 mb-4">Conclusão de Auditoria</h2>
                  <p className="text-slate-500 max-w-2xl mx-auto mb-10 leading-relaxed">
                    Com base nos testes de desenho e efetividade dos controles, complementados pelos testes substantivos via Data Analytics (JET), concluímos que os lançamentos de diário estão...
                  </p>
                  <textarea className="w-full h-48 bg-slate-50 border-2 border-slate-100 rounded-[2rem] p-8 text-sm focus:ring-2 focus:ring-amber-500 outline-none mb-8" placeholder="Digite sua conclusão final fundamentada..."></textarea>
                  
                  <div className="flex justify-center gap-4">
                    <button className="bg-slate-900 text-white px-8 py-4 rounded-2xl font-black hover:bg-slate-800 transition">Finalizar e Assinar</button>
                    <button className="bg-white border border-slate-200 text-slate-600 px-8 py-4 rounded-2xl font-black hover:bg-slate-50 transition">Revisar Pontos</button>
                  </div>
                </div>
              </section>
            )}

          </div>

          {/* SIDEBAR - AUDIT INSIGHTS */}
          <aside className="lg:col-span-3 space-y-8">
            <div className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
              <h3 className="text-sm font-black uppercase text-slate-900 mb-6 flex items-center gap-2">
                <ClipboardList className="w-4 h-4 text-amber-500" /> Resumo do Status
              </h3>
              <div className="space-y-4">
                <StatusItem label="ELC Understanding" status="Concluído" />
                <StatusItem label="Control Testing" status="Em Revisão" color="text-amber-500" />
                <StatusItem label="Substantive JET" status="Pendente" color="text-slate-300" />
              </div>
            </div>

            <div className="bg-amber-500 p-8 rounded-[2rem] text-white shadow-xl shadow-amber-200 relative overflow-hidden group">
              <Info className="absolute -right-4 -bottom-4 w-24 h-24 text-white/20 transform -rotate-12 group-hover:rotate-0 transition-all" />
              <h4 className="font-black text-lg mb-2">Dica de Auditoria</h4>
              <p className="text-xs text-white/80 leading-relaxed">
                Ao testar a burla de controles, sempre verifique lançamentos manuais em contas que possuem integração automática (ex: Depreciação).
              </p>
            </div>

            <div className="p-6 bg-slate-100 border-2 border-dashed border-slate-200 rounded-[2rem] text-center">
              <span className="text-[10px] font-black uppercase text-slate-400 tracking-widest">Documentação Suporte</span>
              <div className="mt-4 flex flex-col gap-2">
                <div className="bg-white p-3 rounded-xl text-[10px] font-bold text-slate-600 flex items-center justify-between">
                   Layout_GL_2025.xlsx <CheckCircle2 className="w-3 h-3 text-green-500" />
                </div>
                <div className="bg-white p-3 rounded-xl text-[10px] font-bold text-slate-600 flex items-center justify-between">
                   Log_Alteracoes_TI.pdf <CheckCircle2 className="w-3 h-3 text-green-500" />
                </div>
              </div>
            </div>
          </aside>

        </div>
      </main>

      {/* FOOTER */}
      <footer className="bg-slate-900 text-slate-400 py-12 mt-20">
        <div className="max-w-7xl mx-auto px-8 grid grid-cols-1 md:grid-cols-4 gap-12 border-b border-white/5 pb-12">
          <div className="col-span-1 md:col-span-2">
             <div className="flex items-center gap-2 mb-6">
                <div className="bg-white text-slate-900 p-1.5 rounded-md">
                  <FileCheck className="w-5 h-5" />
                </div>
                <span className="text-white text-xl font-black tracking-tighter uppercase italic leading-none">Audit<span className="text-amber-500">Educa</span></span>
             </div>
             <p className="text-sm max-w-sm leading-relaxed">
               Padrão ouro em documentação técnica e metodologia de auditoria digital.
             </p>
          </div>
        </div>
        <div className="max-w-7xl mx-auto px-8 pt-8 text-[10px] font-black uppercase tracking-widest">
          <p>© 2026 AuditEduca - Methodology Division</p>
        </div>
      </footer>
    </div>
  );
};

// --- SUB-COMPONENTES ---

const RiskFlag = ({ label, status }) => (
  <div className="bg-white/5 border border-white/10 p-4 rounded-2xl">
    <p className="text-[10px] font-black uppercase text-slate-500 mb-1">{label}</p>
    <div className="flex items-center gap-2">
      <div className={`w-2 h-2 rounded-full ${status === 'Critical' ? 'bg-red-500' : 'bg-amber-500'}`}></div>
      <span className="text-xs font-bold text-white">{status} Risk</span>
    </div>
  </div>
);

const ControlRow = ({ id, desc, tod, toe }) => (
  <tr className="hover:bg-slate-50 transition">
    <td className="px-4 py-4 font-black text-xs text-slate-900">{id}</td>
    <td className="px-4 py-4 text-xs text-slate-500 max-w-xs">{desc}</td>
    <td className="px-4 py-4 text-xs font-bold text-green-600">{tod}</td>
    <td className={`px-4 py-4 text-xs font-bold ${toe === 'Efetivo' ? 'text-green-600' : 'text-red-500'}`}>{toe}</td>
  </tr>
);

const ITTestCard = ({ title, desc, status }) => (
  <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100 flex flex-col justify-between">
    <div>
      <h4 className="text-sm font-bold text-slate-900 mb-2">{title}</h4>
      <p className="text-xs text-slate-500 leading-relaxed">{desc}</p>
    </div>
    <div className="mt-6 flex items-center justify-between">
      <span className={`text-[10px] font-black uppercase ${status === 'Validado' ? 'text-green-600' : 'text-amber-500'}`}>{status}</span>
      <button className="text-[10px] font-black text-indigo-600 uppercase">Documentar</button>
    </div>
  </div>
);

const CriteriaCard = ({ icon, title, desc }) => (
  <div className="p-6 bg-white border border-slate-100 rounded-3xl shadow-sm hover:border-amber-500 transition group">
    <div className="text-amber-500 mb-4 group-hover:scale-110 transition-transform">{icon}</div>
    <h4 className="text-sm font-black text-slate-900 mb-1 uppercase tracking-wider">{title}</h4>
    <p className="text-xs text-slate-500">{desc}</p>
  </div>
);

const StatusItem = ({ label, status, color = "text-green-500" }) => (
  <div className="flex items-center justify-between">
    <span className="text-xs font-medium text-slate-500">{label}</span>
    <span className={`text-[10px] font-black uppercase ${color}`}>{status}</span>
  </div>
);

export default App;