<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <!-- SEO & MONETIZAÇÃO -->
  <title id="page-title">Cálculo de Insulina | Calculadoras de Enfermagem Profissional</title>
  <meta name="description" content="Calculadora profissional para aspiração de insulina em seringas de 100UI e 300UI. Segurança do paciente com 9 certos e auditoria de cálculo clínica.">
  <meta name="keywords" content="insulina, enfermagem, cálculo de medicação, segurança do paciente, seringa insulina, auditoria clínica">
  <meta name="author" content="Calculadoras de Enfermagem">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/insulina.html"/>
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Cálculo de Insulina - Segurança e Precisão">
  <meta property="og:description" content="Ferramenta profissional com protocolos integrados para enfermagem.">
  <meta property="og:url" content="https://auditeduca.github.io/Calculadoras-de-Enfermagem/insulina.html">
  <meta property="og:image" content="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:site_name" content="Calculadoras de Enfermagem">
  <meta property="og:updated_time" content="2026-02-06T00:00:00-03:00">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Cálculo de Insulina - Segurança e Precisão">
  <meta name="twitter:description" content="Ferramenta profissional com protocolos integrados para enfermagem.">
  <meta name="twitter:image" content="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp">
  <meta name="twitter:creator" content="@CalculadorasEnf">

  <link rel="icon" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp" type="image/webp"/>

  <!-- Fontes e Ícones -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@700;800;900&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Estilos Modulares (CSS Externo) -->
  <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/variables-v4.css"/>
  <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/header-v4.css"/>
  <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/footer-v4.css"/>
  <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/accessibility-v4.css"/>

  <!-- Bibliotecas JS (Deferidas) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

  <!-- Schema.org -->
  <script type="application/ld+json">
  {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Calculadora de Aspiração de Insulina",
      "description": "Ferramenta profissional para cálculo preciso de insulina em seringas de 100UI e 300UI",
      "applicationCategory": "MedicalApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript",
      "screenshot": "https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp",
      "author": {
          "@type": "Organization",
          "name": "Calculadoras de Enfermagem"
      }
  }
  </script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { nunito: ['"Nunito Sans"','sans-serif'], inter: ['Inter','sans-serif'] },
          colors: { 
            'nurse-primary':'#1A3E74', 
            'nurse-secondary':'#00bcd4', 
            'nurse-accent':'#00838f', 
            'nurse-bgDark':'#0F172A' 
          },
          animation: {
            'slide-in': 'slideIn 0.3s ease-out',
            'fade-in': 'fadeIn 0.3s ease-out',
            'pulse-slow': 'pulse 3s infinite',
            'bounce-slow': 'bounce 2s infinite',
          }
        }
      }
    }

    async function loadModule(id, url) {
      const container = document.getElementById(id);
      if (!container) return;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Status ${res.status}`);
        container.innerHTML = await res.text();
        container.style.opacity = "1";
        const event = new CustomEvent('moduleLoaded', { detail: { id, url } });
        container.dispatchEvent(event);
      } catch(e) { 
        console.warn(`Módulo ${id} não carregado:`, e); 
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer base {
      body { @apply bg-slate-50 text-slate-900 dark:bg-nurse-bgDark dark:text-slate-100 antialiased font-inter relative transition-colors duration-300; }
      h1 { @apply font-nunito font-black tracking-tight text-nurse-primary dark:text-cyan-400; }
      h2, h3 { @apply font-inter tracking-tight text-nurse-primary dark:text-cyan-400 font-extrabold; }
    }
    @layer components {
      .card-base { @apply bg-white dark:bg-slate-800/90 rounded-[2rem] border border-slate-200 dark:border-slate-700 shadow-sm transition-all overflow-hidden; }
      .sidebar-module { @apply rounded-2xl p-6 shadow-lg text-white bg-gradient-to-br from-[#1A3E74] to-[#2E5A9C] dark:from-[#1e293b] dark:to-[#0f172a] mb-6; }
      .input-field { @apply w-full bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 focus:border-nurse-secondary outline-none transition-all font-medium; }
      .btn-primary-action { @apply bg-nurse-primary hover:bg-nurse-secondary text-white font-bold py-4 px-8 rounded-2xl shadow-xl transition-all active:scale-[0.98] flex items-center justify-center gap-2 text-sm uppercase tracking-wider disabled:opacity-50 disabled:cursor-not-allowed; }
      .btn-secondary-action { @apply bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-200 font-bold py-4 rounded-2xl transition-all flex items-center justify-center gap-2 text-sm uppercase tracking-wider; }
      .tab-btn { @apply flex-1 px-2 py-3 font-bold text-[10px] transition-all border-b-4 border-transparent text-slate-400 hover:text-nurse-primary whitespace-nowrap text-center uppercase tracking-wider; }
      .tab-btn.active { @apply border-nurse-secondary text-nurse-primary dark:text-cyan-400 bg-slate-50/50 dark:bg-slate-900/30; }
      .glass-meta { @apply relative backdrop-blur-md border border-white/20 p-4 rounded-xl shadow-sm transition-all duration-300 flex items-center gap-4; }
      .glass-meta-blue { @apply bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100 border-l-4 border-blue-500; }
      .glass-meta-orange { @apply bg-orange-50 dark:bg-orange-900/20 text-orange-900 dark:text-orange-100 border-l-4 border-orange-500; }
      .toast-msg { @apply pointer-events-auto bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 font-bold text-sm min-w-[320px] border-l-4 border-nurse-secondary animate-slide-in; }
      .tag-pill-footer { @apply px-3 py-1.5 bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-300 rounded-lg text-[11px] font-bold hover:bg-nurse-accent hover:text-white transition-all cursor-pointer; }
      .share-btn { @apply w-10 h-10 rounded-full flex items-center justify-center bg-white/10 text-white hover:bg-white hover:text-nurse-primary transition-all shadow-md; }
      .label-tooltip { @apply text-nurse-secondary ml-1 cursor-help hover:text-nurse-primary transition-colors text-xs; }
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes highlight-pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(0, 188, 212, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(0, 188, 212, 0); }
    }
    
    /* Correção para campos numéricos */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    /* Tooltip melhorado */
    .tooltip-container {
      position: relative;
      display: inline-block;
    }
    
    .tooltip-container:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
      transform: translate(-50%, -10px);
    }
    
    .tooltip-text {
      visibility: hidden;
      width: 220px;
      background-color: #1e293b;
      color: white;
      text-align: left;
      border-radius: 8px;
      padding: 10px;
      position: absolute;
      z-index: 1000;
      bottom: 125%;
      left: 50%;
      transform: translate(-50%, 0);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      font-size: 11px;
      line-height: 1.4;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #1e293b transparent transparent transparent;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">
  
  <!-- HEADER MODULAR -->
  <div id="header-container" style="opacity:0;" class="transition-opacity duration-300"></div>

  <!-- Indicador de Modo Offline -->
  <div id="offline-indicator" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-orange-500 text-white px-6 py-3 rounded-2xl shadow-2xl font-bold text-sm flex items-center gap-2">
    <i class="fa-solid fa-wifi-slash"></i>
    <span>Modo Offline - Algumas funcionalidades podem estar limitadas</span>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-24 right-6 z-[9999] flex flex-col gap-3 pointer-events-none"></div>

  <!-- MAIN CONTENT -->
  <main class="flex-1 py-12 px-4 md:px-8">
    <div class="max-w-7xl mx-auto grid lg:grid-cols-[1fr_380px] gap-8">
      
      <!-- Calculadora Principal -->
      <div class="space-y-8">
        <header class="text-center mb-12 animate-fade-in">
          <span class="inline-block px-6 py-2 bg-gradient-to-r from-nurse-accent to-nurse-secondary text-white font-black text-[9px] uppercase tracking-[0.3em] rounded-full mb-6 shadow-lg">
            <i class="fa-solid fa-shield-check mr-2"></i>
            Auditoria de Cálculo Clínica
          </span>
          <h1 id="calc-titulo" class="text-4xl md:text-6xl mb-4">Cálculo de <span class="text-nurse-secondary">...</span></h1>
          <p id="calc-desc" class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto leading-relaxed italic"></p>
        </header>

        <div class="card-base p-6 md:p-10 shadow-2xl border-t-8 border-t-nurse-primary relative">
          <div class="grid md:grid-cols-2 gap-10">
            
            <!-- Formulário de Entrada -->
            <div class="space-y-6">
              <h3 class="flex items-center gap-3 text-xl font-black">
                <i class="fa-solid fa-vial-circle-check text-nurse-secondary"></i>
                Dados da Prescrição
              </h3>
              
              <div class="group">
                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex items-center gap-2">
                  Concentração do Frasco (UI/ml)
                  <div class="tooltip-container">
                    <i class="fa-solid fa-circle-info label-tooltip"></i>
                    <span class="tooltip-text">Concentração padrão da insulina no frasco. Geralmente 100 UI/ml.</span>
                  </div>
                </label>
                <input 
                  type="number" 
                  id="frasco-ui" 
                  class="input-field" 
                  placeholder="Ex: 100"
                  min="1"
                  step="1"
                  onkeypress="return preventNegative(event)"
                />
              </div>

              <div class="group">
                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex items-center gap-2">
                  Dose Prescrita (UI)
                  <div class="tooltip-container">
                    <i class="fa-solid fa-circle-info label-tooltip"></i>
                    <span class="tooltip-text">Quantidade de insulina prescrita pelo médico em Unidades Internacionais.</span>
                  </div>
                </label>
                <input 
                  type="number" 
                  id="prescricao-ui" 
                  class="input-field" 
                  placeholder="Quantidade em UI"
                  min="0.1"
                  step="0.1"
                  onkeypress="return preventNegative(event)"
                  onkeydown="if(event.ctrlKey && event.key === 'Enter') processarCalculoAuditoria()"
                />
              </div>

              <div class="flex gap-3">
                <button onclick="processarCalculoAuditoria()" class="btn-primary-action flex-1 group">
                  <i class="fa-solid fa-shield-check group-hover:scale-110 transition-transform"></i>
                  Auditar e Calcular
                </button>
                
                <button onclick="limparFormulario()" class="btn-secondary-action px-6">
                  <i class="fa-solid fa-rotate-left"></i>
                </button>
              </div>
            </div>

            <!-- Área de Resultado -->
            <div id="result-display" class="bg-slate-50 dark:bg-slate-900/40 rounded-[2.5rem] p-8 border-2 border-dashed border-slate-200 dark:border-slate-700 flex flex-col items-center justify-center min-h-[300px] transition-all">
              
              <div id="result-placeholder" class="text-center">
                <i class="fa-solid fa-syringe text-5xl text-slate-300 mb-4 opacity-30 animate-pulse"></i>
                <p class="text-slate-400 text-sm font-medium italic">Aguardando dados da prescrição...</p>
                <p class="text-slate-300 text-xs mt-2">Preencha os campos ao lado</p>
              </div>
              
              <div id="result-content" class="hidden w-full text-center animate-fade-in">
                <span class="text-[10px] font-black text-nurse-secondary uppercase tracking-[0.2em]">Volume a Aspirar</span>
                <div class="flex items-baseline justify-center gap-2 my-3">
                  <span id="val-ml" class="text-7xl font-black text-nurse-primary dark:text-white">0.00</span>
                  <span class="text-2xl font-bold text-slate-400">ml</span>
                </div>
                
                <!-- Badge de Tipo de Seringa -->
                <div id="syringe-type-badge" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full text-xs font-bold mb-4 shadow-lg">
                  <i class="fa-solid fa-syringe"></i>
                  <span id="syringe-type-text">Seringa 100UI</span>
                </div>
                
                <div class="mt-6 p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                  <p class="text-[10px] font-bold text-slate-400 uppercase mb-2">
                    <i class="fa-solid fa-calculator text-nurse-secondary mr-1"></i>
                    Memória de Cálculo (Auditoria)
                  </p>
                  <code id="formula-text" class="text-sm font-mono text-nurse-accent dark:text-cyan-400 block"></code>
                </div>

                <!-- Botões de Ação -->
                <div class="flex gap-3 mt-6">
                  <button onclick="copiarResultado()" class="btn-secondary-action flex-1 text-xs">
                    <i class="fa-solid fa-copy"></i>
                    Copiar
                  </button>
                  <button onclick="compartilharResultado()" class="btn-secondary-action flex-1 text-xs">
                    <i class="fa-solid fa-share-nodes"></i>
                    Compartilhar
                  </button>
                </div>
              </div>

            </div>
          </div>

          <!-- Informações Adicionais -->
          <div class="mt-8 grid md:grid-cols-2 gap-4">
            <div class="glass-meta glass-meta-blue">
              <i class="fa-solid fa-flask text-3xl text-blue-500"></i>
              <div>
                <p class="text-[10px] font-black uppercase tracking-wider mb-1">Concentração Padrão</p>
                <p class="font-bold text-sm" id="info-frasco">100 UI/ml</p>
              </div>
            </div>
            
            <div class="glass-meta glass-meta-orange">
              <i class="fa-solid fa-notes-medical text-3xl text-orange-500"></i>
              <div>
                <p class="text-[10px] font-black uppercase tracking-wider mb-1">Dose Prescrita</p>
                <p class="font-bold text-sm" id="info-dose">-- UI</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="space-y-6">
        <!-- Alerta de Segurança -->
        <div class="sidebar-module">
          <h3 class="text-white mb-4 flex items-center gap-2 text-lg font-black">
            <i class="fa-solid fa-triangle-exclamation text-yellow-400"></i>
            Barreira de Erro
          </h3>
          <p id="calc-alerta" class="text-xs leading-relaxed opacity-90 font-medium">
            Sempre verifique a concentração do frasco antes de aspirar. Dupla checagem obrigatória.
          </p>
        </div>

        <!-- Guia Rápido -->
        <div class="card-base p-6 bg-gradient-to-br from-cyan-50 to-blue-50 dark:from-slate-800 dark:to-slate-900 border-none">
          <h4 class="font-black text-sm uppercase tracking-wider text-nurse-primary dark:text-cyan-400 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-graduation-cap"></i>
            Guia Rápido
          </h4>
          <ul class="space-y-3 text-xs text-slate-700 dark:text-slate-300">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-1 text-nurse-secondary mt-0.5 text-[10px]"></i>
              <span><strong>Verifique</strong> a concentração do frasco (normalmente 100 UI/ml)</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-2 text-nurse-secondary mt-0.5 text-[10px]"></i>
              <span><strong>Confira</strong> a prescrição médica (dose em UI)</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-3 text-nurse-secondary mt-0.5 text-[10px]"></i>
              <span><strong>Calcule</strong> o volume usando a ferramenta</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-4 text-nurse-secondary mt-0.5 text-[10px]"></i>
              <span><strong>Realize</strong> dupla checagem antes de administrar</span>
            </li>
          </ul>
        </div>

        <!-- Referências Técnicas -->
        <div class="card-base p-6 bg-slate-100 dark:bg-slate-900/30 border-none">
          <h4 class="font-black text-[11px] uppercase tracking-widest text-slate-500 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-book-medical"></i>
            Referências Técnicas
          </h4>
          <ul class="space-y-3 text-xs font-bold text-slate-600 dark:text-slate-400">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-nurse-secondary mt-0.5"></i>
              <span>Protocolo de Segurança na Prescrição e Administração</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-nurse-secondary mt-0.5"></i>
              <span>COFEN - Guia de Boas Práticas</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-nurse-secondary mt-0.5"></i>
              <span>Ministério da Saúde - Manual de Administração</span>
            </li>
          </ul>
        </div>

        <!-- Atalhos de Teclado -->
        <div class="card-base p-6 bg-purple-50 dark:bg-purple-900/20 border-none">
          <h4 class="font-black text-[11px] uppercase tracking-widest text-purple-700 dark:text-purple-400 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-keyboard"></i>
            Atalhos
          </h4>
          <ul class="space-y-2 text-xs text-slate-600 dark:text-slate-400">
            <li class="flex items-center gap-2">
              <kbd class="px-2 py-1 bg-white dark:bg-slate-800 rounded border border-slate-300 dark:border-slate-600 text-[10px] font-mono">Ctrl + Enter</kbd>
              <span>Calcular</span>
            </li>
            <li class="flex items-center gap-2">
              <kbd class="px-2 py-1 bg-white dark:bg-slate-800 rounded border border-slate-300 dark:border-slate-600 text-[10px] font-mono">Esc</kbd>
              <span>Limpar</span>
            </li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <!-- FOOTER MODULAR -->
  <div id="footer-container" style="opacity:0;" class="transition-opacity duration-300"></div>

  <script>
    // ============================================
    // CONFIGURAÇÃO GLOBAL
    // ============================================
    let dadosConfig = {
      titulo: "Insulina",
      descricao: "Ferramenta profissional para aspiração precisa de insulina com auditoria de cálculo integrada",
      padrao_frasco: 100,
      unidade_entrada: "UI",
      alerta: "⚠️ Sempre verifique a concentração do frasco antes de aspirar. Dupla checagem obrigatória.",
      formula: "Volume (ml) = Dose Prescrita (UI) / Concentração (UI/ml)"
    };

    // ============================================
    // FUNÇÕES DE TOAST
    // ============================================
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const icons = {
        success: 'fa-circle-check',
        error: 'fa-circle-xmark',
        warning: 'fa-triangle-exclamation',
        info: 'fa-circle-info'
      };
      
      const colors = {
        success: 'border-green-500',
        error: 'border-red-500',
        warning: 'border-yellow-500',
        info: 'border-blue-500'
      };
      
      toast.className = `toast-msg ${colors[type]}`;
      toast.innerHTML = `
        <i class="fa-solid ${icons[type]} text-xl"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-auto hover:scale-110 transition-transform">
          <i class="fa-solid fa-xmark"></i>
        </button>
      `;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ============================================
    // INICIALIZAÇÃO
    // ============================================
    async function initCalculadora() {
      try {
        // Configuração já está hardcoded acima
        // Se você quiser usar JSON externo, descomente abaixo:
        /*
        const jsonUrl = 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/insulina.json';
        const response = await fetch(jsonUrl);
        if (!response.ok) throw new Error('Erro ao buscar JSON');
        dadosConfig = await response.json();
        */
        
        // Populando a interface
        document.getElementById('calc-titulo').innerHTML = `Cálculo de <span class="text-nurse-secondary font-black">${dadosConfig.titulo}</span>`;
        document.getElementById('calc-desc').innerText = dadosConfig.descricao;
        document.getElementById('frasco-ui').value = dadosConfig.padrao_frasco;
        document.getElementById('calc-alerta').innerText = dadosConfig.alerta;

        // Carregar módulos externos (Header e Footer)
        loadModule('header-container', 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/modules/header.html');
        loadModule('footer-container', 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/modules/footer.html');

        console.log('✅ Calculadora inicializada com sucesso');
      } catch (err) {
        console.error("❌ Falha na inicialização:", err);
        showToast('Erro ao carregar configurações. Usando valores padrão.', 'warning');
      }
    }

    // ============================================
    // CÁLCULO PRINCIPAL
    // ============================================
    function processarCalculoAuditoria() {
      const frasco = parseFloat(document.getElementById('frasco-ui').value);
      const prescricao = parseFloat(document.getElementById('prescricao-ui').value);

      // Validações
      if (!frasco || frasco <= 0) {
        showToast("⚠️ Informe a concentração do frasco!", "warning");
        document.getElementById('frasco-ui').focus();
        return;
      }

      if (!prescricao || prescricao <= 0) {
        showToast("⚠️ Informe a dose prescrita!", "warning");
        document.getElementById('prescricao-ui').focus();
        return;
      }

      // Cálculo: Volume (ml) = Dose Prescrita (UI) / Concentração (UI/ml)
      const resultadoMl = prescricao / frasco;

      // Determinar tipo de seringa
      let tipoSeringa = "Seringa 100UI";
      if (frasco === 100) {
        tipoSeringa = resultadoMl <= 1 ? "Seringa 100UI" : "Seringa 300UI (3ml)";
      }

      // Atualizar display
      document.getElementById('val-ml').innerText = resultadoMl.toLocaleString('pt-BR', { 
        minimumFractionDigits: 2, 
        maximumFractionDigits: 3 
      });
      
      // Atualizar badge da seringa
      document.getElementById('syringe-type-text').innerText = tipoSeringa;
      
      // Fórmula de auditoria
      document.getElementById('formula-text').innerText = 
        `${frasco} ${dadosConfig.unidade_entrada} --- 1ml | ${prescricao} ${dadosConfig.unidade_entrada} --- ${resultadoMl.toFixed(3)} ml`;

      // Atualizar informações
      document.getElementById('info-frasco').innerText = `${frasco} UI/ml`;
      document.getElementById('info-dose').innerText = `${prescricao} UI`;

      // Animação de transição
      document.getElementById('result-placeholder').classList.add('hidden');
      document.getElementById('result-content').classList.remove('hidden');
      
      const card = document.getElementById('result-display');
      card.classList.add('animate-pulse');
      card.style.borderColor = "#00bcd4";
      card.style.borderStyle = "solid";
      setTimeout(() => {
        card.classList.remove('animate-pulse');
        card.style.animation = 'highlight-pulse 2s ease-in-out';
      }, 800);

      showToast(`✅ Volume calculado: ${resultadoMl.toFixed(2)} ml`, 'success');
    }

    // ============================================
    // FUNÇÕES AUXILIARES
    // ============================================
    function limparFormulario() {
      document.getElementById('prescricao-ui').value = '';
      document.getElementById('frasco-ui').value = dadosConfig.padrao_frasco;
      
      document.getElementById('result-content').classList.add('hidden');
      document.getElementById('result-placeholder').classList.remove('hidden');
      
      document.getElementById('info-dose').innerText = '-- UI';
      document.getElementById('info-frasco').innerText = `${dadosConfig.padrao_frasco} UI/ml`;
      
      const card = document.getElementById('result-display');
      card.style.borderColor = '';
      card.style.borderStyle = 'dashed';
      card.style.animation = '';
      
      document.getElementById('prescricao-ui').focus();
      showToast('Formulário limpo', 'info');
    }

    function copiarResultado() {
      const resultado = document.getElementById('val-ml').innerText;
      const formula = document.getElementById('formula-text').innerText;
      const texto = `Volume a Aspirar: ${resultado} ml\n\nCálculo: ${formula}`;
      
      navigator.clipboard.writeText(texto).then(() => {
        showToast('✅ Resultado copiado para área de transferência!', 'success');
      }).catch(err => {
        showToast('❌ Erro ao copiar', 'error');
        console.error('Erro:', err);
      });
    }

    async function compartilharResultado() {
      const resultado = document.getElementById('val-ml').innerText;
      const formula = document.getElementById('formula-text').innerText;
      const texto = `Volume a Aspirar: ${resultado} ml\n\nCálculo: ${formula}`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Cálculo de Insulina',
            text: texto
          });
          showToast('✅ Compartilhado com sucesso!', 'success');
        } catch (err) {
          if (err.name !== 'AbortError') {
            console.error('Erro ao compartilhar:', err);
          }
        }
      } else {
        copiarResultado();
        showToast('Resultado copiado (compartilhamento não disponível)', 'info');
      }
    }

    function preventNegative(event) {
      if (['-', 'e', '+', 'E'].includes(event.key)) {
        event.preventDefault();
        return false;
      }
      return true;
    }

    // ============================================
    // ATALHOS DE TECLADO
    // ============================================
    document.addEventListener('keydown', (e) => {
      // Esc = Limpar
      if (e.key === 'Escape' || e.key === 'Esc') {
        limparFormulario();
        e.preventDefault();
      }
      
      // Ctrl + Enter = Calcular
      if (e.ctrlKey && e.key === 'Enter') {
        processarCalculoAuditoria();
        e.preventDefault();
      }
    });

    // ============================================
    // INICIALIZAÇÃO AO CARREGAR
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      initCalculadora();
      
      // Auto-focus no primeiro campo
      setTimeout(() => {
        document.getElementById('prescricao-ui')?.focus();
      }, 500);
    });

    // Inicializar funções do header quando carregado
    document.addEventListener('moduleLoaded', (e) => {
      if (e.detail.id === 'header-container') {
        console.log('Header carregado');
        // Adicionar inicializações do header se necessário
      }
    });

    // Detectar status offline
    window.addEventListener('load', () => {
      const offlineIndicator = document.getElementById('offline-indicator');
      
      const updateOnlineStatus = () => {
        if (navigator.onLine) {
          offlineIndicator.classList.add('hidden');
        } else {
          offlineIndicator.classList.remove('hidden');
          showToast('⚠️ Você está offline', 'warning');
        }
      };
      
      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      updateOnlineStatus();
    });

  </script>
</body>
</html>