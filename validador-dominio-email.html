<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validação de Email - Auditeduca</title>

    <!-- 1. CARREGAR O CSS PRIMEIRO (Isso garante a estrutura visual) -->
    <link rel="stylesheet" href="https://auditeduca.com.br/assets/css/global.css">
    <link rel="stylesheet" href="https://auditeduca.com.br/assets/css/header.css">
    <link rel="stylesheet" href="https://auditeduca.com.br/assets/css/main.css">
    <link rel="stylesheet" href="https://auditeduca.com.br/assets/css/footer.css">

    <style>
        /* Ajustes específicos desta página para não quebrar o layout existente */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f9f9f9;
        }

        /* Garante que o Header não seja sobrescrito por margens */
        header {
            position: relative;
            z-index: 1000;
        }

        .content-wrapper {
            flex: 1;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .validation-card {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .validation-card h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn-check {
            background-color: #007bff; /* Ajuste para cor da marca */
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }

        .btn-check:hover { background-color: #0056b3; }
        .btn-check:disabled { background-color: #ccc; cursor: not-allowed; }

        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
            text-align: left;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* Loader simples */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Placeholder VAZIO para o Header -->
    <div id="header-mount"></div>

    <div class="content-wrapper">
        <div class="validation-card">
            <h2>Verificador de Email</h2>
            <p style="margin-bottom: 20px; color: #666;">Validação técnica via Google DNS API</p>
            
            <div class="input-group">
                <input type="email" id="email" placeholder="Digite o e-mail corporativo..." autocomplete="email">
            </div>

            <button class="btn-check" onclick="checkEmail()" id="btnSubmit">
                <span class="spinner" id="spinner"></span>
                <span id="btnText">Validar Agora</span>
            </button>

            <div id="result"></div>
        </div>
    </div>

    <!-- Placeholder VAZIO para o Footer -->
    <div id="footer-mount"></div>

    <!-- SCRIPT DE INICIALIZAÇÃO "MANUAL" -->
    <script>
        // URLs dos recursos originais
        const RESOURCES = {
            headerHTML: 'https://auditeduca.com.br/assets/components/header.html',
            footerHTML: 'https://auditeduca.com.br/assets/components/footer.html',
            // LISTA DE SCRIPTS DO SITE QUE PRECISAM RODAR DEPOIS DO HTML
            siteScripts: [
                'https://auditeduca.com.br/assets/js/utils.js', 
                'https://auditeduca.com.br/assets/js/console-cleaner.js'
                // Adicione aqui outros scripts se o menu depender deles (ex: main.js, bootstrap.js)
            ]
        };

        // 1. Função para carregar HTML (Header/Footer)
        async function loadHtmlComponent(url, elementId) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                
                const wrapper = document.getElementById(elementId);
                wrapper.innerHTML = html;
                
                // Remove o div wrapper para o CSS global funcionar (ex: body > header)
                // Isso "descasca" o header de dentro do <div id="header-mount">
                const content = wrapper.firstElementChild;
                if (content) {
                    wrapper.replaceWith(content);
                }
            } catch (e) {
                console.error("Falha ao carregar componente:", url, e);
            }
        }

        // 2. Função para carregar Scripts JS dinamicamente
        function loadSiteScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        // 3. ORQUESTRADOR (A Mágica acontece aqui)
        async function initPage() {
            // Passo A: Carrega Header e Footer e espera terminar
            await Promise.all([
                loadHtmlComponent(RESOURCES.headerHTML, 'header-mount'),
                loadHtmlComponent(RESOURCES.footerHTML, 'footer-mount')
            ]);

            console.log("HTML Carregado. Iniciando Scripts do Site...");

            // Passo B: Só AGORA carrega os scripts JS do site.
            // Isso garante que o JS encontre o menu HTML no DOM e aplique os eventos (click, hover, etc).
            for (const scriptUrl of RESOURCES.siteScripts) {
                try {
                    await loadSiteScript(scriptUrl);
                } catch (e) {
                    console.error("Erro ao carregar script:", scriptUrl);
                }
            }
            
            console.log("Página completamente montada.");
        }

        // Inicia tudo
        document.addEventListener('DOMContentLoaded', initPage);

        // --- LÓGICA DO VALIDADOR (Independente do Layout) ---
        async function checkEmail() {
            const email = document.getElementById('email').value.trim();
            const resultDiv = document.getElementById('result');
            const btn = document.getElementById('btnSubmit');
            const spinner = document.getElementById('spinner');
            const btnText = document.getElementById('btnText');

            // Reset UI
            resultDiv.style.display = 'none';
            resultDiv.className = '';
            
            if (!email || !email.includes('@')) {
                showMsg('Por favor, insira um e-mail válido.', 'error');
                return;
            }

            // Estado de Carregamento
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btnText.innerText = 'Verificando...';

            const domain = email.split('@')[1];

            try {
                // Chama API Google DNS para verificar MX (Mail Exchange)
                const res = await fetch(`https://dns.google/resolve?name=${domain}&type=MX`);
                const data = await res.json();

                if (data.Status === 0 && data.Answer) {
                    // Ordena por prioridade (menor número = maior prioridade)
                    const mxRecord = data.Answer[0].data;
                    showMsg(`
                        <strong>E-mail Válido!</strong><br>
                        O domínio <em>@${domain}</em> está ativo e configurado para receber e-mails.<br>
                        <small style="color:#555; margin-top:5px; display:block">MX: ${mxRecord}</small>
                    `, 'success');
                } else {
                    showMsg(`
                        <strong>E-mail Inválido ou Inativo.</strong><br>
                        O domínio <em>@${domain}</em> não possui servidores de e-mail (MX Records) válidos.
                    `, 'error');
                }
            } catch (err) {
                showMsg('Erro de conexão com o servidor de validação.', 'error');
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btnText.innerText = 'Validar Agora';
            }
        }

        function showMsg(html, type) {
            const r = document.getElementById('result');
            r.innerHTML = html;
            r.className = type;
            r.style.display = 'block';
        }
    </script>
</body>
</html>